head	1.5;
access;
symbols;
locks
	kyledewey:1.5; strict;
comment	@# @;


1.5
date	2011.06.20.22.19.56;	author kyledewey;	state Exp;
branches;
next	1.4;

1.4
date	2011.06.01.04.05.11;	author kyledewey;	state Exp;
branches;
next	1.3;

1.3
date	2011.04.10.04.06.46;	author kyledewey;	state Exp;
branches;
next	1.2;

1.2
date	2011.04.08.02.31.41;	author kyledewey;	state Exp;
branches;
next	1.1;

1.1
date	2011.04.08.00.18.52;	author kyledewey;	state Exp;
branches;
next	;


desc
@Ties all the GUI components together.
@


1.5
log
@Changed layouts to BoxLayouts.  GUI no longer "jumps".
Added an exit menu routine.
@
text
@/*
 * SentinelVPL.scala
 *
 * Version:
 *     $Id: SentinelVPL.scala,v 1.4 2011/06/01 04:05:11 kyledewey Exp $
 *
 * Revisions:
 *      $Log: SentinelVPL.scala,v $
 *      Revision 1.4  2011/06/01 04:05:11  kyledewey
 *      Now parses in the base language before parsing in
 *      anything else.
 *
 *      Revision 1.3  2011/04/10 04:06:46  kyledewey
 *      Implemented the loading in of projects and
 *      the creation of new language files.
 *
 *      Revision 1.2  2011/04/08 02:31:41  kyledewey
 *      Added support for loading project files.
 *
 * 
 */

package sentinel.vpl

import java.io._
import java.awt._
import java.awt.event._
import javax.swing._
import javax.swing.tree._
import sentinel.model._

/**
 * Holds constants and static routines for SentinelVPL.
 * @@author Kyle Dewey
 */
object SentinelVPL {
  val TITLE = "Sentinel Programming Language"
  val NEW_LANG_TEXT = "New/Load Language"
  val LOAD_PROJ_TEXT = "Load Project File"
  val EXIT_TEXT = "Exit"
}

/**
 * The main GUI for the VPL.  Holds everything together.
 * @@param boardCreator Function that creates the visual board.
 * The visual board needs the whole GUI as a parameter, so it
 * passes <code>this</code> to it
 * @@param descriptionPanelCreator Like <code>boardCreator</code>,
 * but with the descrption panel
 * @@param componentsCreator Like <code>boardCreator</code>, but with
 * the components panel.
 * @@author Kyle Dewey
 */
class SentinelVPL[ T <: AnyRef, U ]( boardCreator: (VisualBoardGUIView[ T, U ]) => VisualBoard[ T, U ],
				     descriptionPanelCreator: (SentinelVPL[ T, U ]) => DescriptionPanel,
				     componentsCreator: (ComponentsTreeGUIView[ T, U ]) => ComponentsTree[ T, U ] )  
extends JFrame( SentinelVPL.TITLE ) with CompleteVPL[ T, U ] with ActionListener {
  import sentinel.project._
  import SentinelVPL._

  LanguageReader.readBaseLanguage()
  // begin instance variables
  private val actions: Map[ String, () => Unit ] = 
    Map( LOAD_PROJ_TEXT -> loadProjectAction,
         NEW_LANG_TEXT -> newLanguageAction,
	 EXIT_TEXT -> exitAction )
  private var nodeDragging: Option[ Node[ T, U ] ] = None
  private var mouseInBoard = false
  val board = boardCreator( this )
  val descPanel = descriptionPanelCreator( this )
  val components = componentsCreator( this )
  val scrollPane = new JScrollPane( components )
  val topPanel = new JPanel()
  val languageManager = new LanguageManager( components.model )
  // end instance variables

  // begin constructor
  setJMenuBar( makeMenu )
  setSize( board.model.width,
	   board.model.height )
  topPanel.setLayout( new BoxLayout( topPanel, BoxLayout.X_AXIS ) )
  topPanel.add( board )
  topPanel.add( scrollPane )
  topPanel.setComponentOrientation( ComponentOrientation.LEFT_TO_RIGHT )

  setLayout( new BorderLayout() )
  add( topPanel, BorderLayout.NORTH )
  add( descPanel, BorderLayout.SOUTH )
  add( topPanel )
  // end constructor

  /**
   * Shows a description of the given describable thing
   * @@param item The describable item
   */
  def showDescription( item: Describable ) {
    descPanel.showDescription( item )
  }

  /**
   * Says that the given node has been selected
   * @@param node The node that has been selected
   */
  def nodeSelected( node: Node[ T, U ] ) {
    showDescription( node )
  }

  /**
   * Says that the given node is being dragged away
   * from the tree that held it.
   * @@param node The node that is being moved
   */
  def nodeDraggingOut( node: Node[ T, U ] ) {
    nodeDragging = Some( node )
  }

  /**
   * Tells us where we are dragging to, relative to the components tree.
   * TO BE CALLED ONLY BY THE TREE.
   * @@param event The mouse event correlating to the drag
   */
  def treeDragging( event: MouseEvent ) {
    if ( nodeDragging.isDefined &&
	 mouseInBoard ) {
      val location = SwingUtilities.convertPoint( components,
						  event.getX,
						  event.getY,
						  board )
      board.showNodeOutline( nodeDragging.get,
			     location.x,
			     location.y )
    }
  }

  /**
   * Says that the node that we were dragging out has been released.
   * TO BE CALLED ONLY BY THE TREE.
   * @@param event The mouse event on the board that correlates to the release
   */
  def nodeReleased( event: MouseEvent ) {
    if ( nodeDragging.isDefined &&
	 mouseInBoard ) {
      val location = SwingUtilities.convertPoint( components,
						  event.getX,
						  event.getY,
						  board )
      board.placeNode( nodeDragging.get,
		       location.x,
		       location.y )
    }
    nodeDragging = None
    board.forgetNodeOutline()
  }

  /**
   * Says that the mouse is in the board.
   */
  def mouseEnteredBoard() {
    mouseInBoard = true
  }

  /**
   * Says that the mouse exited the board.
   */
  def mouseExitedBoard() {
    mouseInBoard = false
  }

  /**
   * Makes a menu item with the given text.
   * Registers <code>this</code> as an ActionListener.
   * @@param text The text for the item
   * @@return The menu item
   */
  protected def makeMenuItem( text: String ) = {
    val retval = new JMenuItem( text )
    retval.addActionListener( this )
    retval
  }

  /**
   * Makes the menu for this component.
   * @@return The menu to use for this component
   */
  protected def makeMenu() = {
    val menuBar = new JMenuBar()
    val file = new JMenu( "File" )
    file.add( makeMenuItem( NEW_LANG_TEXT ) )
    file.add( makeMenuItem( LOAD_PROJ_TEXT ) )
    file.add( makeMenuItem( EXIT_TEXT ) )
    menuBar.add( file )
    menuBar
  }
  
  /**
   * Creates a LoadedLanguage that is associated with this VPL.
   * @@param node The node that is associated with this language.
   * @@param filePath Path to the language file associated with this language
   */
  def makeLanguage( node: DefaultMutableTreeNode ) =
    new SentinelLanguage( components.model, node )

  /**
   * Prompts the user to create a new, empty language.
   */
  def newLanguageAction() {
    val saver = new JFileChooser( "." )
    val action = saver.showSaveDialog( this )
    
    if ( action == JFileChooser.APPROVE_OPTION ) {
      val file = saver.getSelectedFile
      val node = SentinelTreeHelpers.makeLanguageNode( file )
      languageManager.addLanguage( makeLanguage( node ) )
      components.model.insertNodeIntoRoot( node )
    }
  }

  /**
   * Opens a user dialog for loading in a language file.
   */
  def loadProjectAction() {
    val chooser = new JFileChooser( "." )
    val action = chooser.showOpenDialog( this )

    if ( action == JFileChooser.APPROVE_OPTION ) {
      val file = chooser.getSelectedFile
      val node = SentinelTreeHelpers.makeTreeNodeFromProject( file )
      languageManager.addProject( node,
				 ( languageNode: DefaultMutableTreeNode ) =>
				   makeLanguage( languageNode ) )
      components.model.insertNodeIntoRoot( node )
    }
  }

  /**
   * Triggered when the user performs a menu action.
   * @@param event The event correlating to the menu action
   */
  def actionPerformed( event: ActionEvent ) {
    val command = event.getActionCommand
    if ( actions.contains( command ) ) {
      actions( command )()
    }
  }

  /**
   * Exits the program
   */
  def exitAction() {
    System.exit( 0 )
  }
}
@


1.4
log
@Now parses in the base language before parsing in
anything else.
@
text
@d5 1
a5 1
 *     $Id: SentinelVPL.scala,v 1.3 2011/04/10 04:06:46 kyledewey Exp $
d9 4
d38 1
a38 1
  val NEW_LANG_TEXT = "New Language"
d40 1
d59 2
d64 3
a66 2
    Map( SentinelVPL.LOAD_PROJ_TEXT -> loadProjectAction,
         SentinelVPL.NEW_LANG_TEXT -> newLanguageAction )
d81 1
a81 1
  topPanel.setLayout( new FlowLayout() )
d188 3
a190 2
    file.add( makeMenuItem( SentinelVPL.NEW_LANG_TEXT ) )
    file.add( makeMenuItem( SentinelVPL.LOAD_PROJ_TEXT ) )
d245 7
@


1.3
log
@Implemented the loading in of projects and
the creation of new language files.
@
text
@d5 1
a5 1
 *     $Id: SentinelVPL.scala,v 1.2 2011/04/08 02:31:41 kyledewey Exp kyledewey $
d9 4
d53 2
@


1.2
log
@Added support for loading project files.
@
text
@d5 1
a5 1
 *     $Id$
d8 4
a11 1
 *      $Log$
d17 1
d21 1
d30 2
a31 1
  val LOAD_LANG_TEXT = "Load Language File"
d51 2
a52 1
    Map( SentinelVPL.LOAD_LANG_TEXT -> loadLanguageAction )
d60 1
d156 12
d174 2
a175 3
    val item = new JMenuItem( SentinelVPL.LOAD_LANG_TEXT )
    item.addActionListener( this )
    file.add( item )
d179 23
d206 1
a206 1
  def loadLanguageAction() {
d212 5
a216 1
      components.model.insertNodeIntoRoot( SentinelTreeHelpers.makeTreeNodeFromProject( file ) )
@


1.1
log
@Initial revision
@
text
@d3 7
d25 1
d42 1
a42 1
extends JFrame( SentinelVPL.TITLE ) with CompleteVPL[ T, U ] {
d44 2
d56 1
d146 38
@
